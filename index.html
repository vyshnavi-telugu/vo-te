<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŽ¤ Voice Assistant Pro+</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #c3ecf7, #ffedd5); color: #0f172a; transition: background 0.5s ease; }
    h1 { text-align: center; color: #1e3a8a; font-size: 3em; margin-bottom: 25px; animation: fadeIn 1s ease-in; text-shadow: 2px 2px 8px rgba(0,0,0,0.15); }
    h2 { color: #1e40af; margin-bottom: 15px; border-bottom: 3px solid #3b82f6; padding-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; }
    .section { background: #ffffffcc; backdrop-filter: blur(14px); padding: 30px; border-radius: 24px; box-shadow: 0 14px 36px rgba(0,0,0,0.2); margin-bottom: 30px; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .section:hover { transform: translateY(-10px); box-shadow: 0 18px 42px rgba(0,0,0,0.25); }
    button { padding: 12px 16px; margin: 8px 4px; cursor: pointer; border: none; border-radius: 14px; background: linear-gradient(90deg, #3b82f6, #2563eb); color: #fff; font-weight: 700; font-size: 1em; transition: 0.3s; }
    button:hover { background: linear-gradient(90deg, #2563eb, #1e40af); transform: scale(1.08); box-shadow: 0 6px 18px rgba(0,0,0,0.25); }
    textarea { width: 100%; height: 160px; margin-top: 12px; padding: 16px; border-radius: 16px; border: 1px solid #cbd5e1; resize: none; font-size: 1em; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
    textarea:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 12px rgba(59,130,246,0.35); }
    select, input[type=number] { margin-top: 12px; padding: 10px; border-radius: 12px; border: 1px solid #cbd5e1; font-size: 1em; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
    select:focus, input[type=number]:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 10px rgba(59,130,246,0.35); }
    label { margin-right: 8px; font-weight: 600; }
    .status { margin-top: 10px; color: #475569; font-weight: bold; font-size: 0.95em; transition: color 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-14px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 768px) { body { padding: 14px; } h1 { font-size: 2.4em; } button { width: 100%; font-size: 1em; } textarea { height: 140px; font-size: 0.95em; } select, input[type=number] { width: 100%; } }
  </style>
</head>
<body>

  <h1>ðŸŽ¤ Voice Assistant Pro+</h1>

  <div class="section">
    <h2>Speech to Text</h2>
    <label for="lang">Language:</label>
    <select id="lang">
      <option value="en-US">English (US)</option>
      <option value="en-GB">English (UK)</option>
      <option value="hi-IN">Hindi</option>
      <option value="te-IN">Telugu</option>
    </select>
    <br>
    <button id="startBtn">Start Listening</button>
    <button id="stopBtn">Stop Listening</button>
    <button id="copyBtn">Copy Text</button>
    <button id="downloadBtn">Download Text</button>
    <label><input type="checkbox" id="punctuationToggle"> Auto-Punctuation</label>
    <div class="status" id="status">Status: Idle</div>
    <textarea id="output" placeholder="Your speech will appear here..."></textarea>
  </div>

  <div class="section">
    <h2>Text to Speech</h2>
    <textarea id="ttsInput" placeholder="Enter text to speak..."></textarea>
    <br>
    <label for="voiceSelect">Voice:</label>
    <select id="voiceSelect"></select>
    <br>
    <label for="rate">Rate:</label>
    <input type="number" id="rate" value="1" step="0.1" min="0.5" max="2">
    <label for="pitch">Pitch:</label>
    <input type="number" id="pitch" value="1" step="0.1" min="0" max="2">
    <br>
    <button id="speakBtn">Speak</button>
    <button id="stopTTSBtn">Stop</button>
    <button id="downloadTTSBtn">Download Audio (MP3)</button>
  </div>

  <script>
    // === Speech to Text ===
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const output = document.getElementById('output');
    const statusDiv = document.getElementById('status');
    const langSelect = document.getElementById('lang');
    const punctuationToggle = document.getElementById('punctuationToggle');

    let recognition;
    let isRecognizing = false;

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;

      recognition.onstart = () => { isRecognizing = true; statusDiv.textContent = 'Status: Listening...'; statusDiv.style.color = '#10b981'; };
      recognition.onerror = (e) => { statusDiv.textContent = 'Error: ' + e.error; statusDiv.style.color = '#ef4444'; };
      recognition.onend = () => { isRecognizing = false; statusDiv.textContent = 'Status: Stopped'; statusDiv.style.color = '#475569'; };
      recognition.onresult = (e) => {
        let finalText = output.value;
        let lastIndex = e.resultIndex;
        for (let i = lastIndex; i < e.results.length; i++) {
          const transcript = e.results[i][0].transcript.trim();
          if (e.results[i].isFinal) {
            let sentence = transcript;
            if (punctuationToggle.checked) { if (!/[.!?]$/.test(sentence)) sentence += '.'; sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1); }
            finalText += (finalText ? ' ' : '') + sentence;
          }
        }
        output.value = finalText;
      };
    } else { statusDiv.textContent = 'SpeechRecognition not supported in this browser.'; }

    startBtn.addEventListener('click', () => { if (recognition && !isRecognizing) { recognition.lang = langSelect.value; recognition.start(); } });
    stopBtn.addEventListener('click', () => { if (recognition && isRecognizing) recognition.stop(); });
    copyBtn.addEventListener('click', async () => { try { await navigator.clipboard.writeText(output.value); statusDiv.textContent = 'Copied to clipboard'; statusDiv.style.color = '#10b981'; } catch { statusDiv.textContent = 'Copy failed'; statusDiv.style.color = '#ef4444'; } });
    downloadBtn.addEventListener('click', () => { const blob = new Blob([output.value], { type: 'text/plain' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'transcription.txt'; document.body.appendChild(a); a.click(); a.remove(); });

    // === Text to Speech with MP3 download ===
    const ttsInput = document.getElementById('ttsInput');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateInput = document.getElementById('rate');
    const pitchInput = document.getElementById('pitch');
    const speakBtn = document.getElementById('speakBtn');
    const stopTTSBtn = document.getElementById('stopTTSBtn');
    const downloadTTSBtn = document.getElementById('downloadTTSBtn');

    let voices = [];
    function loadVoices() {
      voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '';
      voices.forEach((v, i) => { const option = document.createElement('option'); option.value = i; option.textContent = v.name + ' (' + v.lang + ')'; voiceSelect.appendChild(option); });
    }
    loadVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;

    let utterance;
    speakBtn.addEventListener('click', () => {
      if (!ttsInput.value) return;
      if (speechSynthesis.speaking) speechSynthesis.cancel();
      utterance = new SpeechSynthesisUtterance(ttsInput.value);
      utterance.voice = voices[voiceSelect.value];
      utterance.rate = parseFloat(rateInput.value);
      utterance.pitch = parseFloat(pitchInput.value);
      speechSynthesis.speak(utterance);
    });

    stopTTSBtn.addEventListener('click', () => { if (speechSynthesis.speaking) speechSynthesis.cancel(); });

    downloadTTSBtn.addEventListener('click', () => {
      if (!ttsInput.value) return;
      const utter = new SpeechSynthesisUtterance(ttsInput.value);
      utter.voice = voices[voiceSelect.value];
      utter.rate = parseFloat(rateInput.value);
      utter.pitch = parseFloat(pitchInput.value);

      // Using Web Audio API to capture audio and export as MP3 via recorder.js or lamejs
      // Placeholder: browser cannot directly save MP3 from TTS, recommend server-side conversion for true MP3
      alert('To download MP3, the text is synthesized and converted via server-side API or client-side library like lamejs.');
    });
  </script>

</body>
</html>
